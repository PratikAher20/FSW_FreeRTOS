
#include "cmd.h"


// Function checking the CheckSUM
//void chk_sum();

cmd_t cmd_list[NUM_CMDS];

uint8_t cmd_valid(rx_cmd_t* rx_cmd){
	return 1;  //Will be checking the validated of the checksum.
}

uint8_t chk_s_cmd(rx_cmd_t* rx_cmd){
	cmd_t* cmd;
	cmd->length = (rx_cmd->ccsds_cmd_p1) & 0x07FF;

	if( (rx_cmd->ccsds_cmd_p1 >> 11) & 0x01){
		return 1;
	}
	else{
		return 0;
	}
}

void cmd_Apid_Map(){


}

void add_cmd(uint8_t id, uint16_t length, void (*ex_func)(uint8_t id, uint8_t opcode, uint16_t length)){

	cmd_list[id].id = id;
	cmd_list[id].length = length;
	cmd_list[id].ex_func = ex_func;

}

void vcmd_callback(){
	//Execution for the timer based command
}

void cmd_engine(rx_cmd_t* rx_cmd){

	if(chk_s_cmd(rx_cmd)){
		cmd_timer[0] = xTimerCreate("cmd_timer", pdMS_TO_TICKS(rx_cmd->ccsds_time), pdFALSE, (void*)0, vcmd_callback);
		xTimerStart(cmd_timer[2], 0);
	}
	else{
		 //Send the command struct to detect APID
		cmd_Apid_Map(rx_cmd->ccsds_APID);
	}

}

// Commands Definition

void cmd_noop(uint8_t id, uint8_t opcode){

	uint8_t a;

}

