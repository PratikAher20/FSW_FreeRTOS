#include "cmd.h"
#include "timers.h"

// Function checking the CheckSUM
//void chk_sum();

bool cmd_valid(rxcmd_t* rx_cmd){
	return 1;  //Will be checking the validated of the checksum.
}

bool chk_s_cmd(rx_cmd_t* rx_cmd){
	cmd_t* cmd;
	cmd->length = (rx_cmd->ccsds_cmd_p1) & 0x07FF;

	if( (rx_cmd->ccsds_cmd_p1 >> 11) & 0x01){
		return 1;
	}
	else{
		return 0;
	}
}

void cmd_Apid_Map(){


}


void cmd_engine(rx_cmd_t* rx_cmd){

	if(chk_s_cmd(rx_cmd)){
		cmd_t* cmd;
		pkt_timer[2] = xTimerCreate("cmd_timer", pdMS_TO_TICKS(rx_cmd->ccsds_time), pdFALSE, (void*)0, vcmd_callback);
		xTimerStart(pkt_timer[2], 0);
	}
	else{
		 //Send the command struct to detect APID
		cmd_Apid_Map(rx_cmd->ccsds_APID);
	}

}

